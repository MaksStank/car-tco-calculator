# Техническое задание: CarCost — система расчета стоимости владения автомобилем

# 1. Название и концепция

**Название проекта:** Система расчета стоимости владения автомобилем (TCO)

**Концепция:** Веб-сервис для расчета полной стоимости владения автомобилем (TCO - Total Cost of Ownership). Система помогает автолюбителям и потенциальным покупателям автомобилей принимать обоснованные финансовые решения, предоставляя детальный анализ текущих и прогнозируемых расходов, сравнение разных автомобилей и визуализацию структуры затрат.

**Решаемая проблема:** Большинство автовладельцев учитывают только расходы на топливо и страховку, не замечая "скрытых" затрат (амортизация, ремонты, ТО, штрафы). Сервис автоматизирует учет всех расходов и предоставляет четкую финансовую картину владения автомобилем.

# 2. Целевая аудитория и роли

# Целевая аудитория

# Первичная аудитория:
1. *Потенциальные покупатели* автомобилей (новая или подержанная техника):
   - Хотят сравнить несколько моделей по долгосрочным затратам
   - Нуждаются в точном расчете бюджета на содержание
   - Ищут объективные данные, а не маркетинговые обещания

2. *Текущие автовладельцы:*
   - Хотят систематизировать учет расходов
   - Планируют продажу/покупку и нуждаются в оценке реальной стоимости владения
   - Желают оптимизировать расходы на содержание авто

3. *Коммерческие пользователи:* 
    - Владельцы автопарков (малый бизнес)
    - Фрилансеры, использующие автомобиль для работы (курьеры, такси)
    - Лизинговые компании для расчета стоимости лизинга

# Вторичная аудитория:
1. *Финансовые консультанты* - для анализа клиентских расходов
2. *Страховые компании* - для расчета рисков и тарифов
3. *Автодилеры* - для предоставления клиентам прозрачной картины расходов

# Географический охват:
- Первоначально: Россия (русифицированный интерфейс, поддержка российских регионов, цены в рублях)
- Потенциальное расширение: страны СНГ с аналогичной структурой расходов

# Особенности целевой аудитории:
- *Техническая грамотность:* Средняя/высокая (комфортно с веб-сервисами)
- *Возраст:* 25-55 лет (активные автовладельцы и покупатели)
- *Доход:* Средний и выше среднего (владельцы личных автомобилей)
- *Ценность:* Финансовая прозрачность, долгосрочное планирование, оптимизация расходов

# Роли пользователей:

1. *Гость (неавторизованный пользователь):*
   - Просмотр демо-версии сервиса с примерными расчетами
   - Доступ к странице "Как это работает"
   - Возможность использовать калькулятор быстрого расчета TCO с предустановленными значениями
   - Регистрация и вход в систему

2. *Авторизованный пользователь:*
   - Полный доступ к личному кабинету
   - Добавление/удаление автомобилей в "Мой гараж"
   - Ввод и редактирование расходов по категориям
   - Просмотр аналитического дашборда с графиками
   - Использование инструмента сравнения автомобилей
   - Настройка параметров расчета (регион, пробег и т.д.)
   - Доступ к прогнозу расходов

3. *Администратор:*
   - Управление всеми моделями через админ-панель Django
   - Наполнение справочников (категории расходов, стандартные нормы)
   - Мониторинг использования API
   - Техническая поддержка пользователей

# 3. Схема данных (Сущности)

# Основные модели:

1. *Car (Автомобиль)*
   - Поля: 
     - `brand` (CharField) - марка автомобиля (из API)
     - `model` (CharField) - модель автомобиля (из API)
     - `year` (IntegerField) - год выпуска
     - `engine_volume` (FloatField) - объем двигателя в литрах
     - `fuel_type` (CharField) - тип топлива (бензин/дизель/электричество)
     - `transmission` (CharField) - тип КПП (автомат/механика)
     - `average_consumption` (FloatField) - средний расход топлива (л/100км)
     - `external_id` (CharField) - идентификатор из внешнего API (опционально)

2. *Ownership (Владение/Экземпляр автомобиля у пользователя)*
   - Поля:
     - `user` (ForeignKey to User) - владелец
     - `car` (ForeignKey to Car) - автомобиль
     - `purchase_date` (DateField) - дата покупки
     - `purchase_price` (DecimalField) - стоимость покупки
     - `initial_mileage` (IntegerField) - пробег при покупке
     - `region` (CharField) - регион эксплуатации (для учета региональных цен)
     - `annual_mileage` (IntegerField) - планируемый годовой пробег
     - `is_active` (BooleanField) - активно ли владение

3. *ExpenseCategory (Категория расходов)*
   - Поля:
     - `name` (CharField) - название категории (Топливо, Страховка, ТО и т.д.)
     - `unit` (CharField) - единица измерения (литры, рубли, штуки)
     - `average_cost` (DecimalField) - средняя стоимость для расчетов (обновляется на основе введенных данных)
     - `depreciation_coefficient` (FloatField) - коэффициент износа для расчета амортизации

4. *Expense (Расход)*
   - Поля:
     - `ownership` (ForeignKey to Ownership) - к какому владению относится
     - `category` (ForeignKey to ExpenseCategory) - категория расхода
     - `amount` (DecimalField) - сумма расхода
     - `date` (DateField) - дата расхода
     - `mileage` (IntegerField) - пробег на момент расхода
     - `description` (TextField) - описание расхода
     - `is_forecast` (BooleanField) - является ли запись прогнозной (сгенерированной системой)

# Связи между моделями:

User (стандартная модель Django)
↓ (One-to-Many)
Ownership
├── (Many-to-One) → Car
└── (One-to-Many) → Expense
↓ (Many-to-One)
ExpenseCategory


# 4. Основные сценарии пользователя (User Stories)

# Сценарий 1: "Я хочу добавить свой автомобиль и начать учет расходов"
1. Пользователь регистрируется/входит в систему
2. Переходит в раздел "Мой гараж" и нажимает "Добавить автомобиль"
3. Заполняет форму: выбирает марку/модель из выпадающего списка (данные подгружаются из API) или вводит вручную
4. Указывает параметры владения (дата покупки, цена, пробег, регион)
5. Система автоматически создает связанные объекты и переводит пользователя на страницу нового автомобиля

# Сценарий 2: "Я хочу внести расходы и увидеть аналитику"
1. Пользователь заходит в карточку своего автомобиля
2. Нажимает "Добавить расход" и заполняет форму (тип расхода, сумма, дата, описание)
3. После сохранения система пересчитывает все показатели TCO
4. Пользователь видит обновленный дашборд с:
   - Общей суммой расходов за период
   - Структурой расходов по категориям (круговая диаграмма)
   - Динамикой расходов по месяцам (линейный график)
   - Прогнозом расходов на следующий месяц

# Сценарий 3: "Я хочу сравнить два автомобиля по стоимости владения"
1. Пользователь переходит в раздел "Сравнение"
2. Выбирает два автомобиля из своего гаража или добавляет новый для сравнения
3. Задает период сравнения (1, 3, 5 лет)
4. Система рассчитывает TCO для каждого автомобиля с учетом:
   - Реальных введенных расходов (если есть)
   - Прогнозных значений на основе средних статистик
   - Региональных цен на топливо (из API)
5. Пользователь получает детальный отчет с визуальным сравнением и рекомендацией

# Сценарий 4: "Я хочу получить прогноз расходов на следующий год"
1. Пользователь нажимает "Сформировать прогноз" в карточке автомобиля
2. Система анализирует исторические данные пользователя и средние показатели
3. С учетом планируемого пробега, износа и инфляции генерирует прогноз
4. Результат отображается в виде таблицы и графика, которые можно сохранить в PDF

# Сценарий 5: "Я хочу увидеть, как изменится TCO при смене региона"
1. Пользователь редактирует параметры владения, меняя регион
2. Система пересчитывает расходы на топливо (используя API цен на топливо)
3. Пересчитывает стоимость страховки (если есть региональные коэффициенты)
4. Обновляет все показатели на дашборде

# 5. Технический стек и интеграции

# Основной стек:
- *Backend:* Python 3.10+, Django 4.2+, Django REST Framework (для API)
- *Database:* SQLite (разработка) → PostgreSQL (продакшен)
- *Frontend:* HTML, CSS, JavaScript, Bootstrap 5.3, Plotly.js
- *Хостинг:* PythonAnywhere

# Внешние интеграции (API):

1. **API данных об автомобилях:**
   - *Источник:* NHTSA Vehicle API (бесплатный) или RapidAPI (Car Data API)
   - *Функция:* Автодополнение марок и моделей при добавлении автомобиля
   - *Данные:* Справочник марок, моделей, годов выпуска, характеристик
   - *Пример запроса:* `GET https://vpic.nhtsa.dot.gov/api/vehicles/GetModelsForMake/honda?format=json`

2. **API цен на топливо:**
   - *Источник:* Aggregator API (например, данные с агрегаторов АЗС) или Open Data
   - *Функция:* Получение актуальных цен на топливо по регионам РФ
   - *Данные:* Цены на АИ-92, АИ-95, АИ-98, дизель по регионам
   - *Периодичность обновления:* Ежедневно через Celery task

# Библиотеки анализа данных:
- *Pandas:* Для агрегации и обработки данных о расходах перед построением графиков
- *Plotly:* Для создания интерактивных графиков и диаграмм на дашборде
- *NumPy:* Для математических расчетов при прогнозировании

# Дополнительные инструменты:
- *Celery + Redis:* Для периодических задач (обновление цен на топливо, напоминания о ТО)
- *python-dotenv:* Для управления настройками и секретами
- *django-crispy-forms:* Для улучшенного отображения форм с Bootstrap
- *reportlab или weasyprint:* Для генерации PDF-отчетов (бонусная функция)




## 6. Алгоритмы и бизнес-логика

### Формула расчета TCO:


### Алгоритм прогнозирования:
1. Сбор исторических данных пользователя
2. Анализ сезонности расходов (например, зимой больше затрат на подготовку)
3. Учет планируемого пробега
4. Применение коэффициентов инфляции к каждой категории
5. Учет износа (увеличение затрат на ремонты со временем)
6. Генерация помесячного прогноза

## 7. ER-диаграмма базы данных

```mermaid
erDiagram
    User ||--o{ Ownership : owns
    Car ||--o{ Ownership : "instance_of"
    Ownership ||--o{ Expense : has
    ExpenseCategory ||--o{ Expense : categorizes
    
    User {
        int id PK
        string username
        string email
        string password
        datetime date_joined
    }
    
    Car {
        int id PK
        string brand
        string model
        int year
        float engine_volume
        string fuel_type
        string transmission
        float average_consumption
        string external_id
    }
    
    Ownership {
        int id PK
        int user_id FK
        int car_id FK
        date purchase_date
        decimal purchase_price
        int initial_mileage
        string region
        int annual_mileage
        boolean is_active
    }
    
    ExpenseCategory {
        int id PK
        string name
        string unit
        decimal average_cost
        float depreciation_coefficient
    }
    
    Expense {
        int id PK
        int ownership_id FK
        int category_id FK
        decimal amount
        date date
        int mileage
        string description
        boolean is_forecast
    }